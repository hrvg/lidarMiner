<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with `lidarMiner` • lidarMiner</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with `lidarMiner`">
<meta property="og:description" content="lidarMiner">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lidarMiner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/lidarMiner.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started with <code>lidarMiner</code>
</h1>
                        <h4 class="author">Hervé Guillon</h4>
                        
            <h4 class="date">27 August 2020</h4>
      
      
      <div class="hidden name"><code>lidarMiner.Rmd</code></div>

    </div>

    
    
<div id="mining-metadata-from-rocky-ftp" class="section level1">
<h1 class="hasAnchor">
<a href="#mining-metadata-from-rocky-ftp" class="anchor"></a>Mining metadata from Rocky FTP</h1>
<p>Most of the elevation data for the United States are hosted by the USGS on the <a href="rockyftp.cr.usgs.gov:/vdelivery/Datasets/Staged/Elevation/1m/Projects">Rocky FTP</a>. Here, each project (and sometimes work packages within a project) is hosted in its own folder with three subfolders:</p>
<ul>
<li>
<code>TIFF</code> which contains the actual tiles of the dataset as large <code>.tif</code> files;</li>
<li>
<code>browse</code> which contains <code>.jpg</code> previews for internet browsing platforms like <a href="https://viewer.nationalmap.gov/basic/">The National Map</a>;</li>
<li>
<code>metadata</code> which contains metadata for each tile as light-weight <code>.xml</code> files.</li>
</ul>
<p>These metadata files can be mined with the following commands, here for California, as indicated by <code>CA</code>:</p>
<ol style="list-style-type: decimal">
<li>Calling <code>mkdir data</code> at the root of the repository will create the <code>/data</code> folder</li>
<li>
<code>cd data</code> will change to <code>data/</code>
</li>
<li>
<code>lftp rockyftp.cr.usgs.gov:/vdelivery/Datasets/Staged/Elevation/1m/Projects</code> connects to Rocky FTP</li>
<li>
<code>mirror --no-empty-dirs -n . . -i "(_CA_).*(xml)$"</code> downloads the files matching the regular expression <code>"(_CA_).*(xml)$"</code>.
<ul>
<li>You can kill this command once it has run past the state of interest.</li>
<li>It takes around 20 min to download all the metadata for California.</li>
</ul>
</li>
</ol>
</div>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>For the rest of this example, we will use the packages: <code>lidarMiner</code> and <code>raster</code> (which loads <code>sp</code>).</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lidarMiner</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)
<span class="co">#&gt; Loading required package: sp</span></pre></body></html></div>
</div>
<div id="executing-lidarminer-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#executing-lidarminer-functions" class="anchor"></a>Executing <code>lidarMiner</code> functions</h1>
<p>This chunk executes all functions from <code>lidarMiner</code>, listing the files at a specified path, reading the <code>.xml</code> files and extracting the spatial information into a <code>SpatialPolygonsDataFrame</code>. The files required files are included with the package and stored in <code>/inst/extdata</code> that we access with <code>system.file</code>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">list_files</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidarMiner/man/list_lidar_files.html">list_lidar_files</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"lidarMiner"</span>))
<span class="no">lidar_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidarMiner/man/get_lidar_df.html">get_lidar_df</a></span>(<span class="no">list_files</span>)
<span class="no">lidar_bbox</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidarMiner/man/get_lidar_bbox.html">get_lidar_bbox</a></span>(<span class="no">lidar_df</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">lidar_bbox</span>)</pre></body></html></div>
<p><img src="lidarMiner_files/figure-html/executing%20lidarMiner%20functions-1.png" width="576"></p>
</div>
<div id="leveraging-the-bounding-box-of-the-lidar-datasets-to-select-the-target-tiles" class="section level1">
<h1 class="hasAnchor">
<a href="#leveraging-the-bounding-box-of-the-lidar-datasets-to-select-the-target-tiles" class="anchor"></a>Leveraging the bounding box of the lidar datasets to select the target tiles</h1>
<p>First, let’s load a <code>region_boundary</code> shapefile and a <code>sampling_locations</code> shapefile. The first describes the boundary of an area of interest, here the North Central Coast of California, USA. The second holds the locations of points of interest within the region, here field location of channel morphology sampling.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">region_boundary</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/shapefile.html">shapefile</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"region_boundary.shp"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"lidarMiner"</span>))
<span class="no">sampling_locations</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/shapefile.html">shapefile</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"sampling_locations.shp"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"lidarMiner"</span>))
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">region_boundary</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">sampling_locations</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="lidarMiner_files/figure-html/loading%20test%20data-1.png" width="576"></p>
<p>It might be useful to add some buffering around the point if you know how you will use the lidar datasets. For example, as I know that I will search for topographical information in squared tile <span class="math inline">\(500\times500\)</span>-m, I add a circular buffer of <span class="math inline">\(\sqrt{2}\cdot 250\)</span>-m around each location. This ensures that I capture enough lidar data to proceed with my downstream analysis.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">sampling_locations_polygons</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/buffer.html">buffer</a></span>(<span class="no">sampling_locations</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fl">2</span>) * <span class="fl">250</span>, <span class="kw">dissolve</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>Because the <code>sampling_locations</code> and <code>region_boundary</code> do not share the same CRS as <code>lidar_bbox</code>, this chunk handles some CRS conversions with <code>spTransform</code>.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">region_boundary</span> <span class="kw">&lt;-</span> <span class="fu">spTransform</span>(<span class="no">region_boundary</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span>(<span class="no">lidar_bbox</span>))
<span class="no">sampling_locations</span> <span class="kw">&lt;-</span> <span class="fu">spTransform</span>(<span class="no">sampling_locations</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span>(<span class="no">lidar_bbox</span>))
<span class="no">sampling_locations_polygons</span> <span class="kw">&lt;-</span> <span class="fu">spTransform</span>(<span class="no">sampling_locations_polygons</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span>(<span class="no">lidar_bbox</span>))</pre></body></html></div>
<p>We are now ready to perform a spatial intersect. We perform a spatial intersect with the region boundary to speed up the subsequent intersect with the sample locations.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">lidar_bbox</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/intersect.html">intersect</a></span>(<span class="no">lidar_bbox</span>, <span class="no">region_boundary</span>)
<span class="co">#&gt; Loading required namespace: rgeos</span>
<span class="no">lidar_sampling_locations</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/intersect.html">intersect</a></span>(<span class="no">lidar_bbox</span>, <span class="no">sampling_locations_polygons</span>)
<span class="no">unique_networkr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span>(<span class="no">lidar_sampling_locations</span>$<span class="no">networkr</span>))
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">lidar_bbox</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">lidar_bbox</span>[<span class="no">lidar_bbox</span>$<span class="no">networkr</span> <span class="kw">%in%</span> <span class="no">unique_networkr</span>, ], <span class="kw">col</span> <span class="kw">=</span> <span class="st">"green"</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">sampling_locations_polygons</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="lidarMiner_files/figure-html/spatial%20intersect-1.png" width="576"></p>
<p>You can note that in the center of the region, two tiles have been selected thanks to the buffering.</p>
<p>Finally, the <code>networkr</code> field of the resulting <code>lidar_sampling_locations</code> holds the URLs of the tiles we need.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span>(<span class="no">unique_networkr</span>)
<span class="co">#&gt; [1] "ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Elevation/1m/Projects/CA_FEMA_R9_Mendocino_HF_2017/TIFF/USGS_one_meter_x43y435_CA_FEMA_R9_Mendocino_HF_2017.tif"</span>
<span class="co">#&gt; [2] "ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Elevation/1m/Projects/CA_FEMA_R9_Mendocino_HF_2017/TIFF/USGS_one_meter_x44y431_CA_FEMA_R9_Mendocino_HF_2017.tif"</span>
<span class="co">#&gt; [3] "ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Elevation/1m/Projects/CA_FEMA_R9_Mendocino_HF_2017/TIFF/USGS_one_meter_x45y430_CA_FEMA_R9_Mendocino_HF_2017.tif"</span>
<span class="co">#&gt; [4] "ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Elevation/1m/Projects/CA_FEMA_R9_Mendocino_HF_2017/TIFF/USGS_one_meter_x45y434_CA_FEMA_R9_Mendocino_HF_2017.tif"</span>
<span class="co">#&gt; [5] "ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Elevation/1m/Projects/CA_FEMA_R9_Mendocino_HF_2017/TIFF/USGS_one_meter_x45y437_CA_FEMA_R9_Mendocino_HF_2017.tif"</span>
<span class="co">#&gt; [6] "ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Elevation/1m/Projects/CA_FEMA_R9_Mendocino_HF_2017/TIFF/USGS_one_meter_x46y431_CA_FEMA_R9_Mendocino_HF_2017.tif"</span></pre></body></html></div>
<p>We can use the <code>curl</code> package to download all the files.</p>
<pre><code>for (url in unique_networkr) curl::curl_download(url, file.path("/media/hguillon/UCD eFlow BigData1/", basename(url)))</code></pre>
<p>Finally, the function <code><a href="https://rdrr.io/pkg/lidarMiner/man/merge_lidar_rasters.html">merge_lidar_rasters()</a></code>, takes care of creating the mosaic of all the lidar files in a given folder.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Hervé Guillon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
